<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Neon Lab Physics WOW - Ultra Realistic Physics Engine</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-633RQLC6T0"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-633RQLC6T0');
        
        window.trackDonationClick = function(amount = 'custom') {
            gtag('event', 'donation_click', {
                source: 'neon_lab_physics_wow',
                amount: amount,
                value: parseFloat(amount) || 1
            });
        };
    </script>
    
    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4837743291717475"
         crossorigin="anonymous"></script>
    <!-- Consent Mode v2 + Banner -->
    <script defer src="/consent.js"></script>
    
    <!-- PWA Icons -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='16' fill='%23FF0080'/%3E%3Cpath d='M8 8h16v8H8z' fill='%23FFFF00' stroke='%23FFFFFF'/%3E%3Ccircle cx='12' cy='24' r='3' fill='%2339FF14'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' rx='40' fill='%23FF0080'/%3E%3Cpath d='M40 40h40v40H40z' fill='%23FFFF00' stroke='%23FFFFFF' stroke-width='3'/%3E%3Ccircle cx='60' cy='120' r='12' fill='%2339FF14'/%3E%3Ctext x='90' y='110' font-family='monospace' font-size='24' fill='%2300FFFF'%3ELAB WOW%3C/text%3E%3C/svg%3E">
    <meta name="theme-color" content="#FF0080">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 25%, #16213e 50%, #0e3460 75%, #0a0a0a 100%);
            color: #00FFFF;
            overflow-x: hidden;
            user-select: none;
            touch-action: manipulation;
            min-height: 100vh;
        }

        .particles-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle-bg {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #00FFFF;
            border-radius: 50%;
            animation: float 8s linear infinite;
            opacity: 0.6;
        }

        @keyframes float {
            from { 
                transform: translateY(100vh) translateX(0px);
                opacity: 0;
            }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            to { 
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        .header {
            height: 60px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(20,20,40,0.9));
            border-bottom: 3px solid #00FFFF;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            position: relative;
            z-index: 10;
            box-shadow: 0 0 20px rgba(0,255,255,0.3);
        }
        
        .title { 
            font-size: 1.8rem; 
            font-weight: 900; 
            color: #39FF14;
            text-shadow: 0 0 10px #39FF14;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 0 10px #39FF14, 0 0 20px #39FF14; }
            to { text-shadow: 0 0 20px #39FF14, 0 0 30px #39FF14, 0 0 40px #39FF14; }
        }
        
        .level-info { 
            font-size: 1rem; 
            color: #00FFFF;
            text-shadow: 0 0 5px #00FFFF;
        }
        
        .lives-display { 
            font-size: 1.2rem;
            text-shadow: 0 0 5px #FF0080;
        }
        
        .instructions {
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(20,20,40,0.9));
            color: #00FFFF;
            padding: 12px;
            text-align: center;
            font-size: 12px;
            border-bottom: 2px solid #FF0080;
            position: relative;
            z-index: 10;
        }
        
        .game-area {
            height: calc(100vh - 200px);
            display: flex;
            justify-content: center;
            align-items: center;
            background: 
                linear-gradient(90deg, transparent 49%, rgba(0, 255, 255, 0.05) 50%, transparent 51%),
                linear-gradient(0deg, transparent 49%, rgba(0, 255, 255, 0.05) 50%, transparent 51%);
            background-size: 20px 20px;
            position: relative;
            overflow: hidden;
        }

        .game-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        canvas {
            border: 3px solid #FF0080;
            box-shadow: 
                0 0 20px rgba(255, 0, 128, 0.5),
                inset 0 0 20px rgba(0, 255, 255, 0.2);
            background: linear-gradient(135deg, rgba(0,0,0,0.8), rgba(20,20,40,0.8));
            touch-action: none;
            position: relative;
            z-index: 5;
        }
        
        .controls {
            height: 100px;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(20,20,40,0.9));
            border-top: 3px solid #00FFFF;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            padding: 12px;
            position: relative;
            z-index: 10;
            box-shadow: 0 0 20px rgba(0,255,255,0.3);
        }
        
        button {
            background: linear-gradient(45deg, #FF0080, #00FFFF);
            border: 2px solid #FFFFFF;
            color: #000;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            font-size: 12px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(255, 0, 128, 0.3);
        }
        
        button:hover {
            background: linear-gradient(45deg, #00FFFF, #FF0080);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 255, 255, 0.5);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .secondary {
            background: linear-gradient(45deg, #39FF14, #FFFF00);
            color: #000;
        }
        
        .tertiary {
            background: linear-gradient(45deg, #8A2BE2, #FF00FF);
            color: #FFF;
        }

        .donation-section {
            margin-top: 10px;
        }

        .donation-section h3 {
            color: #FFFF00; 
            margin-bottom: 10px; 
            font-size: 12px;
            text-align: center;
        }

        .donation-section div {
            display: flex; 
            gap: 8px; 
            justify-content: center; 
            flex-wrap: wrap;
        }

        .donation-section a {
            padding: 8px 12px; 
            background: linear-gradient(45deg, #4CAF50, #8BC34A); 
            color: white; 
            font-weight: bold;
            border-radius: 6px; 
            text-decoration: none; 
            font-size: 11px;
            transition: all 0.3s ease;
        }

        .donation-section a:nth-child(2) {
            background: linear-gradient(45deg, #FF9800, #FFC107);
        }

        .donation-section a:nth-child(3) {
            background: linear-gradient(45deg, #E91E63, #F06292);
        }

        .donation-section a:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .flash-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 0, 0.4) 0%, transparent 70%);
            z-index: 1000;
            animation: flash 0.5s ease-out;
            pointer-events: none;
        }
        
        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .impact-effect {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFFF00, transparent);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            animation: impact 0.3s ease-out;
        }
        
        @keyframes impact {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }
        
        .trail-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00FFFF;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            animation: trailFade 0.5s ease-out forwards;
        }

        @keyframes trailFade {
            0% { 
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }
        
        @media (max-width: 768px) {
            .game-area { height: calc(100vh - 180px) !important; }
            .controls { 
            position: fixed;
                bottom: 0; 
            left: 0;
                right: 0; 
            z-index: 1000;
                height: 80px;
            }
            canvas {
                width: 95vw !important;
                height: auto !important;
                max-width: 350px;
                max-height: 60vh;
            }
            .title { font-size: 1.4rem; }
            button { padding: 10px 16px; font-size: 11px; }
        }
    </style>
</head>
<body>
    <!-- Background Particles -->
    <div class="particles-bg" id="particlesBg"></div>

    <!-- Ads -->
    <div id="top-banner" style="position:fixed;top:0;left:0;width:100%;height:50px;background:rgba(0,0,0,0.9);z-index:9998;display:none;align-items:center;justify-content:center;border-bottom:2px solid #00FFFF;">
        <ins class="adsbygoogle" style="display:block;width:320px;height:50px;" data-ad-client="ca-pub-4837743291717475" data-ad-slot="6673201053"></ins>
    </div>
    <div id="bottom-banner" style="position:fixed;bottom:0;left:0;width:100%;height:50px;background:rgba(0,0,0,0.9);z-index:9998;display:none;align-items:center;justify-content:center;border-top:2px solid #00FFFF;">
        <ins class="adsbygoogle" style="display:block;width:320px;height:50px;" data-ad-client="ca-pub-4837743291717475" data-ad-slot="6673201053"></ins>
    </div>
    
    <div id="side-banner" style="position:fixed; right:10px; top:50%; transform:translateY(-50%); width:120px; height:600px; background:rgba(0,0,0,0.8); border:1px solid #00FFFF; border-radius:8px; display:none; z-index:1000;">
        <ins class="adsbygoogle" 
             style="display:block;width:120px;height:600px;" 
             data-ad-client="ca-pub-4837743291717475" 
             data-ad-slot="6673201053"></ins>
    </div>

    <div class="header">
        <div class="title">🧪 NEON LAB PHYSICS WOW</div>
        <div class="level-info" id="levelDisplay">LEVEL 1</div>
        <div class="lives-display" id="livesDisplay">❤️❤️❤️</div>
    </div>
    
    <div id="menu-banner" style="margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.8); border: 1px solid #00FFFF; border-radius: 8px; text-align: center;">
        <ins class="adsbygoogle" 
             style="display:block;width:320px;height:50px;" 
             data-ad-client="ca-pub-4837743291717475" 
             data-ad-slot="6673201053"></ins>
    </div>
    
    <div class="instructions">
        🎯 ARRASTRA objetos, DOBLE TAP para rotar, presiona LAUNCH para lanzar
    </div>
    
    <div class="game-area">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
    </div>
    
    <div class="controls">
        <button onclick="resetLevel()">🔄 RESET</button>
        <button onclick="launchParticle()">🚀 LAUNCH</button>
        <button class="secondary" onclick="nextLevel()">➡️ NEXT</button>
        <button class="tertiary" onclick="showHelp()">❓ HELP</button>
        <div class="donation-section">
            <h3>💖 ¡Apoya el desarrollo!</h3>
            <div>
                <a href="https://paypal.me/lipastudios/0.50" target="_blank" onclick="trackDonationClick('0.50')">☕ 0,50€</a>
                <a href="https://paypal.me/lipastudios/2.00" target="_blank" onclick="trackDonationClick('2.00')">🍕 2€</a>
                <a href="https://paypal.me/lipastudios/5.00" target="_blank" onclick="trackDonationClick('5.00')">🎮 5€</a>
            </div>
        </div>
    </div>

    <script>
        console.log("🧪 NEON LAB PHYSICS WOW - ULTRA REALISTIC VERSION");
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            currentLevel: 1,
            objects: [],
            particle: null,
            launcher: null,
            chamber: null,
            draggedObject: null,
            dragOffset: { x: 0, y: 0 },
            lives: 3,
            maxLives: 3,
            score: 0,
            effects: [],
            particles: []
        };
        
        let isDragging = false;
        let lastTapTime = 0;
        let tapTarget = null;
        let lastTime = 0;
        let animationId = null;
        
        // Initialize background particles
        function initBackgroundParticles() {
            const container = document.getElementById('particlesBg');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-bg';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                container.appendChild(particle);
            }
        }
        
        // Responsive canvas
        function resizeCanvas() {
            if (window.innerWidth < 768) {
                const maxWidth = Math.min(400, window.innerWidth - 20);
                const maxHeight = Math.min(600, window.innerHeight * 0.6);
                canvas.width = maxWidth;
                canvas.height = maxHeight;
            } else {
                canvas.width = 400;
                canvas.height = 600;
            }
        }
        
        class GameObject {
            constructor(type, x, y, width, height, color) {
                this.type = type;
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.rotation = 0;
                this.draggable = type !== 'launcher' && type !== 'chamber';
                this.glowIntensity = 0;
                this.pulsePhase = 0;
            }
            
            update(deltaTime) {
                this.pulsePhase += deltaTime * 3;
                this.glowIntensity = Math.sin(this.pulsePhase) * 0.3 + 0.7;
            }
            
            render(ctx) {
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                ctx.rotate(this.rotation);
                
                // Enhanced glow effect
                ctx.shadowColor = this.color;
                ctx.shadowBlur = 15 * this.glowIntensity;
                ctx.lineWidth = 3;
                ctx.strokeStyle = this.color;
                ctx.fillStyle = this.color;
                
                if (this.type === 'ramp') {
                    // Enhanced triangle with gradient
                    const gradient = ctx.createLinearGradient(-this.width/2, -this.height/2, this.width/2, this.height/2);
                    gradient.addColorStop(0, this.color);
                    gradient.addColorStop(1, this.color + '80');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.moveTo(-this.width/2, this.height/2);
                    ctx.lineTo(this.width/2, this.height/2);
                    ctx.lineTo(this.width/2, -this.height/2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                } else if (this.type === 'bouncy-pad') {
                    // Enhanced circle with radial gradient
                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.width/2);
                    gradient.addColorStop(0, this.color);
                    gradient.addColorStop(1, this.color + '60');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.width/2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                } else {
                    // Enhanced rectangle with gradient
                    const gradient = ctx.createLinearGradient(-this.width/2, -this.height/2, this.width/2, this.height/2);
                    gradient.addColorStop(0, this.color);
                    gradient.addColorStop(1, this.color + '80');
                    
                    ctx.fillStyle = gradient;
                    ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
                    ctx.strokeRect(-this.width/2, -this.height/2, this.width, this.height);
                }
                
                ctx.restore();
            }
            
            contains(x, y) {
                return x >= this.x && x <= this.x + this.width && 
                       y >= this.y && y <= this.y + this.height;
            }
        }
        
        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = 150;
                this.vy = -100;
                this.radius = 6;
                this.active = true;
                this.trail = [];
                this.bounces = 0;
                this.energy = 1.0;
                this.glowPhase = 0;
                this.sparkles = [];
            }
            
            update(deltaTime) {
                if (!this.active) return;
                
                this.glowPhase += deltaTime * 10;
                
                // Enhanced gravity with air resistance
                this.vy += 400 * deltaTime;
                this.vx *= 0.999; // Air resistance
                
                // Update position
                this.x += this.vx * deltaTime;
                this.y += this.vy * deltaTime;
                
                // Create sparkles
                if (Math.random() < 0.3) {
                    this.sparkles.push({
                        x: this.x + (Math.random() - 0.5) * 20,
                        y: this.y + (Math.random() - 0.5) * 20,
                        life: 0.5,
                        maxLife: 0.5
                    });
                }
                
                // Update sparkles
                this.sparkles = this.sparkles.filter(sparkle => {
                    sparkle.life -= deltaTime;
                    return sparkle.life > 0;
                });
                
                // Check collisions
                for (let obj of gameState.objects) {
                    if (this.collidesWith(obj)) {
                        this.handleCollision(obj);
                        break;
                    }
                }
                
                // Boundary collisions with enhanced effects
                if (this.x <= this.radius || this.x >= canvas.width - this.radius) {
                    this.vx = -this.vx * 0.85;
                    this.x = Math.max(this.radius, Math.min(canvas.width - this.radius, this.x));
                    this.createImpactEffect(this.x, this.y);
                }
                if (this.y <= this.radius) {
                    this.vy = Math.abs(this.vy) * 0.85;
                    this.y = this.radius;
                    this.createImpactEffect(this.x, this.y);
                }
                
                // Update trail
                this.trail.push({ x: this.x, y: this.y, life: 1.0 });
                this.trail.forEach(point => point.life -= deltaTime * 2);
                this.trail = this.trail.filter(point => point.life > 0);
                
                // Deactivate if falls off screen
                if (this.y > canvas.height + 100) {
                    this.active = false;
                    loseLife();
                }
                
                // Energy loss over time
                this.energy -= deltaTime * 0.1;
                if (this.energy <= 0) {
                    this.active = false;
                }
            }
            
            createImpactEffect(x, y) {
                const effect = document.createElement('div');
                effect.className = 'impact-effect';
                effect.style.left = x + 'px';
                effect.style.top = y + 'px';
                document.body.appendChild(effect);
                setTimeout(() => effect.remove(), 300);
            }
            
            collidesWith(obj) {
                const closestX = Math.max(obj.x, Math.min(this.x, obj.x + obj.width));
                const closestY = Math.max(obj.y, Math.min(this.y, obj.y + obj.height));
                
                const dx = this.x - closestX;
                const dy = this.y - closestY;
                
                return (dx * dx + dy * dy) < (this.radius * this.radius);
            }
            
            handleCollision(obj) {
                const centerX = obj.x + obj.width / 2;
                const centerY = obj.y + obj.height / 2;
                
                let normalX = this.x - centerX;
                let normalY = this.y - centerY;
                const length = Math.sqrt(normalX * normalX + normalY * normalY);
                
                if (length > 0) {
                    normalX /= length;
                    normalY /= length;
                }
                
                // Push particle out
                this.x = centerX + normalX * (obj.width/2 + this.radius + 1);
                this.y = centerY + normalY * (obj.height/2 + this.radius + 1);
                
                // Enhanced bounce with energy loss
                const elasticity = obj.type === 'bouncy-pad' ? 1.2 : 0.8;
                const dot = this.vx * normalX + this.vy * normalY;
                
                this.vx -= 2 * dot * normalX * elasticity * this.energy;
                this.vy -= 2 * dot * normalY * elasticity * this.energy;
                
                // Ramp behavior
                if (obj.type === 'ramp') {
                    const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
                    const angle = obj.rotation - Math.PI/4;
                    this.vx = Math.cos(angle) * speed * 0.9;
                    this.vy = Math.sin(angle) * speed * 0.9;
                }
                
                this.bounces++;
                this.createImpactEffect(this.x, this.y);
                
                // Add screen shake for big impacts
                if (this.bounces % 3 === 0) {
                    document.body.style.animation = 'shake 0.1s ease-in-out';
                    setTimeout(() => document.body.style.animation = '', 100);
                }
            }
            
            render(ctx) {
                if (!this.active) return;
                
                // Enhanced trail with fading
                this.trail.forEach((point, index) => {
                    const alpha = point.life * (index + 1) / this.trail.length;
                    ctx.save();
                    ctx.globalAlpha = alpha * 0.8;
                    ctx.fillStyle = '#FFFF00';
                    ctx.shadowColor = '#FFFF00';
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, this.radius * alpha, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
                
                // Main particle with enhanced glow
                ctx.save();
                ctx.shadowColor = '#FFFF00';
                ctx.shadowBlur = 20 * this.energy;
                ctx.fillStyle = '#FFFF00';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * this.energy, 0, Math.PI * 2);
                ctx.fill();
                
                // Inner core
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * 0.5 * this.energy, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
                
                // Render sparkles
                this.sparkles.forEach(sparkle => {
                    ctx.save();
                    ctx.globalAlpha = sparkle.life / sparkle.maxLife;
                    ctx.fillStyle = '#00FFFF';
                    ctx.shadowColor = '#00FFFF';
                    ctx.shadowBlur = 5;
                    ctx.beginPath();
                    ctx.arc(sparkle.x, sparkle.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
            }
        }
        
        // Enhanced level definitions
        const levels = [
            {
                name: "Tutorial",
                objects: [
                    { type: 'ramp', x: 200, y: 400, width: 80, height: 60, color: '#FF0080' },
                    { type: 'bouncy-pad', x: 150, y: 300, width: 40, height: 40, color: '#39FF14' }
                ],
                target: { x: 300, y: 500, radius: 30 }
            },
            {
                name: "Bounce House",
                objects: [
                    { type: 'bouncy-pad', x: 100, y: 200, width: 50, height: 50, color: '#39FF14' },
                    { type: 'bouncy-pad', x: 250, y: 300, width: 50, height: 50, color: '#39FF14' },
                    { type: 'ramp', x: 150, y: 400, width: 100, height: 80, color: '#FF0080' }
                ],
                target: { x: 350, y: 500, radius: 30 }
            },
            {
                name: "Gravity Maze",
                objects: [
                    { type: 'block', x: 50, y: 150, width: 60, height: 20, color: '#00FFFF' },
                    { type: 'block', x: 150, y: 200, width: 60, height: 20, color: '#00FFFF' },
                    { type: 'block', x: 250, y: 250, width: 60, height: 20, color: '#00FFFF' },
                    { type: 'ramp', x: 100, y: 350, width: 120, height: 100, color: '#FF0080' }
                ],
                target: { x: 200, y: 500, radius: 30 }
            }
        ];
        
        function initLevel(levelIndex) {
            gameState.currentLevel = levelIndex + 1;
            gameState.objects = [];
            gameState.particle = null;
            gameState.effects = [];
            gameState.particles = [];
            
            const level = levels[levelIndex];
            level.objects.forEach(objData => {
                const obj = new GameObject(
                    objData.type,
                    objData.x, 
                    objData.y, 
                    objData.width, 
                    objData.height, 
                    objData.color
                );
                gameState.objects.push(obj);
            });
            
            // Create launcher
            gameState.launcher = new GameObject('launcher', 50, canvas.height - 100, 30, 30, '#FFFF00');
            gameState.objects.push(gameState.launcher);
            
            // Create target chamber
            gameState.chamber = new GameObject('chamber', level.target.x - level.target.radius, level.target.y - level.target.radius, level.target.radius * 2, level.target.radius * 2, '#FF0080');
            gameState.objects.push(gameState.chamber);
            
            updateUI();
        }
        
        function updateUI() {
            document.getElementById('levelDisplay').textContent = `LEVEL ${gameState.currentLevel}`;
            document.getElementById('livesDisplay').textContent = '❤️'.repeat(gameState.lives);
        }
        
        function launchParticle() {
            if (gameState.particle && gameState.particle.active) return;
            
            gameState.particle = new Particle(gameState.launcher.x + 15, gameState.launcher.y + 15);
            
            // Add launch effect
            const effect = document.createElement('div');
            effect.className = 'flash-effect';
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 500);
        }
        
        function resetLevel() {
            initLevel(gameState.currentLevel - 1);
        }
        
        function nextLevel() {
                if (gameState.currentLevel < levels.length) {
                initLevel(gameState.currentLevel);
                } else {
                alert('🎉 ¡Felicidades! Has completado todos los niveles!');
            }
        }
        
        function loseLife() {
            gameState.lives--;
            updateUI();
            
            if (gameState.lives <= 0) {
                alert('💀 Game Over! Inténtalo de nuevo.');
                gameState.lives = gameState.maxLives;
                initLevel(0);
            }
        }
        
        function showHelp() {
            alert(`🧪 NEON LAB PHYSICS WOW - AYUDA

🎯 OBJETIVO: Lanza la partícula para que llegue a la cámara roja

🎮 CONTROLES:
• Arrastra objetos para moverlos
• Doble tap para rotar objetos
• Presiona LAUNCH para lanzar

🔧 OBJETOS:
• 🟡 LAUNCHER: Punto de lanzamiento
• 🔴 TARGET: Objetivo a alcanzar
• 🔺 RAMP: Rampa que desvía la partícula
• 🟢 BOUNCY PAD: Superficie elástica
• 🔵 BLOCK: Bloque sólido

¡Usa la física realista para resolver cada puzzle!`);
        }
        
        function gameLoop(currentTime) {
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;
            
            // Clear canvas with enhanced background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update and render objects
            gameState.objects.forEach(obj => {
                obj.update(deltaTime);
                obj.render(ctx);
            });
            
            // Update and render particle
            if (gameState.particle) {
                gameState.particle.update(deltaTime);
                gameState.particle.render(ctx);
                
                // Check if particle reached target
                if (gameState.particle.active && gameState.chamber) {
                    const dx = gameState.particle.x - (gameState.chamber.x + gameState.chamber.width/2);
                    const dy = gameState.particle.y - (gameState.chamber.y + gameState.chamber.height/2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < gameState.chamber.width/2) {
                        // Level completed!
                        gameState.particle.active = false;
                        gameState.score += 100;
                        
                        // Celebration effect
                        for (let i = 0; i < 20; i++) {
                            const sparkle = document.createElement('div');
                            sparkle.className = 'trail-particle';
                            sparkle.style.left = (gameState.chamber.x + gameState.chamber.width/2) + 'px';
                            sparkle.style.top = (gameState.chamber.y + gameState.chamber.height/2) + 'px';
                            sparkle.style.background = ['#FF0080', '#00FFFF', '#39FF14', '#FFFF00'][Math.floor(Math.random() * 4)];
                            document.body.appendChild(sparkle);
                            setTimeout(() => sparkle.remove(), 500);
                        }
            
            setTimeout(() => {
                            nextLevel();
                        }, 1000);
                    }
                }
            }
            
            animationId = requestAnimationFrame(gameLoop);
        }
        
        // Event listeners
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            for (let obj of gameState.objects) {
                if (obj.draggable && obj.contains(x, y)) {
                    gameState.draggedObject = obj;
                    gameState.dragOffset = { x: x - obj.x, y: y - obj.y };
                    isDragging = true;
                    break;
                }
            }
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (!isDragging || !gameState.draggedObject) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            gameState.draggedObject.x = x - gameState.dragOffset.x;
            gameState.draggedObject.y = y - gameState.dragOffset.y;
        });
        
        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            gameState.draggedObject = null;
        });
        
        // Touch events
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            const currentTime = Date.now();
            if (currentTime - lastTapTime < 300) {
                // Double tap - rotate object
                for (let obj of gameState.objects) {
                    if (obj.draggable && obj.contains(x, y)) {
                        obj.rotation += Math.PI / 4;
                        break;
                    }
                }
            }
            lastTapTime = currentTime;
            
            for (let obj of gameState.objects) {
                if (obj.draggable && obj.contains(x, y)) {
                    gameState.draggedObject = obj;
                    gameState.dragOffset = { x: x - obj.x, y: y - obj.y };
                    isDragging = true;
                    break;
                }
            }
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!isDragging || !gameState.draggedObject) return;
            
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            gameState.draggedObject.x = x - gameState.dragOffset.x;
            gameState.draggedObject.y = y - gameState.dragOffset.y;
        });
        
        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            isDragging = false;
            gameState.draggedObject = null;
        });
        
        // Initialize game
        window.addEventListener('load', () => {
                resizeCanvas();
            initBackgroundParticles();
            initLevel(0);
            lastTime = performance.now();
            gameLoop(lastTime);
        });
        
        window.addEventListener('resize', resizeCanvas);
        
        // Add shake animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-2px); }
                75% { transform: translateX(2px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>